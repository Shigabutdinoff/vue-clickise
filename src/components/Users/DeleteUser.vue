<script>
export default {
  name: 'DeleteUserButton',
  props: {
    userId: {
      type: Number,
      required: true,
    },
  },
  emits: ['userDeleted'],
  methods: {
    async deleteUser() {
      try {
        const response = await this.deleteUserRequest();
        if (!response.ok) {
          throw new Error(`–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å id ${this.userId}`);
        }

        // –°–æ–æ–±—â–∞–µ–º —Ä–æ–¥–∏—Ç–µ–ª—é –æ–± —É–¥–∞–ª–µ–Ω–∏–∏
        this.$emit('userDeleted', this.userId);
      } catch (error) {
        this.handleError(error);
      }
    },
    async deleteUserRequest() {
      return fetch(`http://localhost/api/users/${this.userId}`, {
        method: 'DELETE',
      });
    },
    handleError(error) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
    },
  },
};
</script>

<template>
  <button @click="deleteUser" class="btn btn-danger">
    üóëÔ∏è
  </button>
</template>

<style scoped>
button {
  font-size: 0.9em;
}

button:hover {
  background-color: darkred;
}
</style>
